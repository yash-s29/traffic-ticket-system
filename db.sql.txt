-- Create the database
CREATE DATABASE `traffic-ticket-system`;
USE `traffic-ticket-system`;

DROP TABLE IF EXISTS Tickets, Vehicles, Drivers, Violations, Admin, Alerts;

-- Admin Table (for login)
CREATE TABLE Admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL
);

-- Sample admin
INSERT INTO Admin (username, password) VALUES ('admin', 'admin123');

-- Vehicles Table
CREATE TABLE Vehicles (
    vehicle_id INT AUTO_INCREMENT PRIMARY KEY,
    vehicle_number VARCHAR(50) NOT NULL UNIQUE,
    vehicle_type VARCHAR(50) DEFAULT 'Sedan'
);

-- Drivers Table
CREATE TABLE Drivers (
    driver_id INT AUTO_INCREMENT PRIMARY KEY,
    driver_name VARCHAR(100) NOT NULL,
    driver_contact VARCHAR(20) DEFAULT NULL
);

-- Violations Table
CREATE TABLE Violations (
    violation_id INT AUTO_INCREMENT PRIMARY KEY,
    violation_name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT DEFAULT NULL,
    suggested_fine DECIMAL(10,2) DEFAULT 0
);

-- Tickets Table
CREATE TABLE Tickets (
    ticket_id INT AUTO_INCREMENT PRIMARY KEY,
    vehicle_id INT NOT NULL,
    driver_id INT NOT NULL,
    violation_id INT NOT NULL,
    ticket_date DATE DEFAULT CURRENT_DATE,
    issue_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    status ENUM('Open','Closed') DEFAULT 'Open',
    ticket_code VARCHAR(100) UNIQUE,
    emergency_level ENUM('Normal','High','Critical') DEFAULT 'Normal',
    fine_amount DECIMAL(10,2) DEFAULT 0,
    remarks TEXT DEFAULT NULL,
    priority_score INT DEFAULT 0, -- optional numeric score for dynamic priority
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (vehicle_id) REFERENCES Vehicles(vehicle_id) ON DELETE CASCADE,
    FOREIGN KEY (driver_id) REFERENCES Drivers(driver_id) ON DELETE CASCADE,
    FOREIGN KEY (violation_id) REFERENCES Violations(violation_id) ON DELETE CASCADE
);

-- Alerts Table (for Emergency Alerts or notifications)
CREATE TABLE Alerts (
    alert_id INT AUTO_INCREMENT PRIMARY KEY,
    ticket_id INT DEFAULT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    status ENUM('Active','Resolved') DEFAULT 'Active',
    FOREIGN KEY (ticket_id) REFERENCES Tickets(ticket_id) ON DELETE SET NULL
);

-- Sample Vehicles
INSERT IGNORE INTO Vehicles (vehicle_number, vehicle_type) VALUES 
('ABC1234', 'Sedan'), 
('XYZ5678', 'SUV'), 
('LMN3456', 'Truck'), 
('DEF7890', 'Hatchback'), 
('GHI2345', 'Van'),
('JKL6789', 'SUV'), 
('ASD9080', 'Sedan'), 
('RTY7689', 'Truck'), 
('EWQ6678', 'Van'), 
('CDV4589', 'Hatchback');

-- Sample Drivers
INSERT IGNORE INTO Drivers (driver_name, driver_contact) VALUES 
('John Doe', '9876543210'), 
('Jane Smith', '9876543211'), 
('Michael Johnson', '9876543212'), 
('Emily Davis', '9876543213'), 
('William Brown', '9876543214'),
('Linda Wilson', '9876543215'), 
('David Miller', '9876543216'), 
('Barbara Moore', '9876543217'), 
('Richard Taylor', '9876543218'), 
('Susan Anderson', '9876543219');

-- Sample Violations
INSERT IGNORE INTO Violations (violation_name, description, suggested_fine) VALUES 
('Speeding', 'Exceeding speed limits', 100.00), 
('Running Red Light', 'Crossing a red traffic signal', 150.00), 
('Illegal Parking', 'Parking in unauthorized area', 50.00), 
('Expired Registration', 'Vehicle registration expired', 80.00),
('No Seatbelt', 'Not wearing seatbelt while driving', 40.00), 
('Driving Without License', 'Operating vehicle without valid license', 200.00), 
('Reckless Driving', 'Dangerous and careless driving', 300.00),
('Using Mobile While Driving', 'Distracted driving using phone', 120.00), 
('Expired Insurance', 'Driving without valid insurance', 150.00), 
('Noise Violation', 'Excessive noise from vehicle', 30.00);
